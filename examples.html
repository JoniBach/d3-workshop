<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3.js Workshop - NASA Asteroid Visualizations</title>
    <link rel="stylesheet" href="styles.css">
    <!-- D3.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
</head>
<body>
    <header>
        <h1>üöÄ D3.js Workshop: NASA Asteroid Visualizations</h1>
        <p>Exploring Near-Earth Objects (NEO) data from January 1-8, 2024</p>
        <div id="data-summary"></div>
        <div id="loading" class="loading">Loading asteroid data...</div>
    </header>

    <!-- API Schema Documentation -->
    <section class="api-schema-section">
        <details>
            <summary><strong>üìã API Response Schema</strong> (Click to expand)</summary>
            <div class="schema-content">
                <h3>NASA NEO API Response Structure</h3>
                <p><strong>Endpoint:</strong> <code>https://api.nasa.gov/neo/rest/v1/feed</code></p>
                
                <h4>Raw API Response Schema:</h4>
                <pre><code>{
  "links": {
    "next": "string",
    "prev": "string",
    "self": "string"
  },
  "element_count": "number",
  "near_earth_objects": {
    "YYYY-MM-DD": [
      {
        "id": "string",
        "name": "string",
        "absolute_magnitude_h": "number",
        "estimated_diameter": {
          "kilometers": {
            "estimated_diameter_min": "number",
            "estimated_diameter_max": "number"
          }
        },
        "is_potentially_hazardous_asteroid": "boolean",
        "close_approach_data": [
          {
            "close_approach_date": "string",
            "relative_velocity": {
              "kilometers_per_hour": "string"
            },
            "miss_distance": {
              "kilometers": "string"
            }
          }
        ]
      }
    ]
  }
}</code></pre>

                <h4>Processed Data Structure (Used in Visualizations):</h4>
                <pre><code>{
  "asteroids": [
    {
      "id": "string",
      "name": "string",
      "date": "YYYY-MM-DD",
      "diameter_min": "number (km)",
      "diameter_max": "number (km)",
      "diameter_avg": "number (km)",
      "is_hazardous": "boolean",
      "velocity": "number (km/h)",
      "miss_distance": "number (km)",
      "absolute_magnitude": "number"
    }
  ],
  "dates": ["YYYY-MM-DD", ...],
  "total_count": "number",
  "hazardous_count": "number",
  "non_hazardous_count": "number"
}</code></pre>

                <h4>Key Fields Explained:</h4>
                <ul>
                    <li><strong>id:</strong> Unique identifier for the asteroid</li>
                    <li><strong>name:</strong> Official asteroid designation</li>
                    <li><strong>diameter_avg:</strong> Average estimated diameter in kilometers</li>
                    <li><strong>is_hazardous:</strong> Whether NASA classifies it as potentially hazardous</li>
                    <li><strong>velocity:</strong> Relative velocity in km/h</li>
                    <li><strong>miss_distance:</strong> Distance from Earth at closest approach (km)</li>
                    <li><strong>absolute_magnitude:</strong> Brightness measurement (H)</li>
                </ul>
            </div>
        </details>
    </section>

    <main id="dashboard">
        <!-- Dashboard will be dynamically generated by chart_registry.js -->
    </main>

    <footer>
        <p>Data source: <a href="https://api.nasa.gov/" target="_blank">NASA NeoWs API</a></p>
        <p>Built with <a href="https://d3js.org/" target="_blank">D3.js v7.8.5</a></p>
    </footer>

    <!-- Configuration (API Key) -->
    <script src="config.js"></script>
    
    <!-- Data Fetcher -->
    <script src="examples/js/data_fetcher.js"></script>
    
    <!-- Chart Registry (must load before visualizations) -->
    <script src="examples/js/chart_registry.js"></script>

    <!-- Visualization Scripts -->
    <script src="examples/js/bar_chart.js"></script>
    <script src="examples/js/horizontal_bar.js"></script>
    <script src="examples/js/grouped_bar.js"></script>
    <script src="examples/js/stacked_bar.js"></script>
    <script src="examples/js/pie_chart.js"></script>
    <script src="examples/js/donut_chart.js"></script>
    <script src="examples/js/histogram.js"></script>
    <script src="examples/js/box_plot.js"></script>
    <script src="examples/js/violin_plot.js"></script>
    <script src="examples/js/scatter_plot.js"></script>
    <script src="examples/js/bubble_chart.js"></script>
    <script src="examples/js/heatmap.js"></script>
    <script src="examples/js/line_chart.js"></script>
    <script src="examples/js/area_chart.js"></script>
    <script src="examples/js/stream_graph.js"></script>
    <script src="examples/js/timeline.js"></script>
    <script src="examples/js/treemap.js"></script>
    <script src="examples/js/sunburst.js"></script>
    <script src="examples/js/force_directed.js"></script>
    <script src="examples/js/sankey.js"></script>

    <!-- Main initialization script -->
    <script>
        // Initialize the dashboard when page loads
        async function initDashboard() {
            try {
                // Fetch and process data first
                const data = await initializeData();
                
                // Build dashboard structure dynamically from chart registry
                // (do this after data loads to ensure all scripts are loaded)
                buildDashboard();
                
                // Hide loading indicator
                document.getElementById('loading').style.display = 'none';
                
                // Show data summary
                const summary = document.getElementById('data-summary');
                summary.innerHTML = `
                    <div class="summary-stats">
                        <span class="stat">Total Asteroids: <strong>${data.total_count}</strong></span>
                        <span class="stat hazardous">Hazardous: <strong>${data.hazardous_count}</strong></span>
                        <span class="stat safe">Non-Hazardous: <strong>${data.non_hazardous_count}</strong></span>
                    </div>
                `;
                
                // Render all visualizations using registry
                renderAllCharts(data);
                
                console.log('‚úÖ All visualizations rendered!');
            } catch (error) {
                console.error('‚ùå Error initializing dashboard:', error);
                document.getElementById('loading').innerHTML = '‚ùå Error loading data. Please refresh the page.';
            }
        }

        // Start the dashboard when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initDashboard);
        } else {
            initDashboard();
        }
    </script>
</body>
</html>
